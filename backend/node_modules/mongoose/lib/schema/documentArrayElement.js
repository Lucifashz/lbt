/*!
 * Module dependencies.
 */

'use strict';

const MongooseError = require('../error/mongooseError');
<<<<<<< HEAD
const SchemaType = require('../schematype');
const SubdocumentPath = require('./SubdocumentPath');
=======
const SchemaType = require('../schemaType');
const SchemaSubdocument = require('./subdocument');
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
const getConstructor = require('../helpers/discriminator/getConstructor');

/**
 * DocumentArrayElement SchemaType constructor.
 *
 * @param {String} path
 * @param {Object} options
 * @inherits SchemaType
 * @api public
 */

<<<<<<< HEAD
function DocumentArrayElement(path, options) {
=======
function SchemaDocumentArrayElement(path, options) {
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
  this.$parentSchemaType = options && options.$parentSchemaType;
  if (!this.$parentSchemaType) {
    throw new MongooseError('Cannot create DocumentArrayElement schematype without a parent');
  }
  delete options.$parentSchemaType;

  SchemaType.call(this, path, options, 'DocumentArrayElement');

  this.$isMongooseDocumentArrayElement = true;
}

/**
 * This schema type's name, to defend against minifiers that mangle
 * function names.
 *
 * @api public
 */
<<<<<<< HEAD
DocumentArrayElement.schemaName = 'DocumentArrayElement';

DocumentArrayElement.defaultOptions = {};
=======
SchemaDocumentArrayElement.schemaName = 'DocumentArrayElement';

SchemaDocumentArrayElement.defaultOptions = {};
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e

/*!
 * Inherits from SchemaType.
 */
<<<<<<< HEAD
DocumentArrayElement.prototype = Object.create(SchemaType.prototype);
DocumentArrayElement.prototype.constructor = DocumentArrayElement;
=======
SchemaDocumentArrayElement.prototype = Object.create(SchemaType.prototype);
SchemaDocumentArrayElement.prototype.constructor = SchemaDocumentArrayElement;
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e

/**
 * Casts `val` for DocumentArrayElement.
 *
 * @param {Object} value to cast
 * @api private
 */

<<<<<<< HEAD
DocumentArrayElement.prototype.cast = function(...args) {
=======
SchemaDocumentArrayElement.prototype.cast = function(...args) {
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
  return this.$parentSchemaType.cast(...args)[0];
};

/**
 * Casts contents for queries.
 *
 * @param {String} $cond
 * @param {any} [val]
 * @api private
 */

<<<<<<< HEAD
DocumentArrayElement.prototype.doValidate = function(value, fn, scope, options) {
=======
SchemaDocumentArrayElement.prototype.doValidate = function(value, fn, scope, options) {
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
  const Constructor = getConstructor(this.caster, value);

  if (value && !(value instanceof Constructor)) {
    value = new Constructor(value, scope, null, null, options && options.index != null ? options.index : null);
  }

<<<<<<< HEAD
  return SubdocumentPath.prototype.doValidate.call(this, value, fn, scope, options);
=======
  return SchemaSubdocument.prototype.doValidate.call(this, value, fn, scope, options);
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
};

/**
 * Clone the current SchemaType
 *
 * @return {DocumentArrayElement} The cloned instance
 * @api private
 */

<<<<<<< HEAD
DocumentArrayElement.prototype.clone = function() {
=======
SchemaDocumentArrayElement.prototype.clone = function() {
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
  this.options.$parentSchemaType = this.$parentSchemaType;
  const ret = SchemaType.prototype.clone.apply(this, arguments);
  delete this.options.$parentSchemaType;

  ret.caster = this.caster;
  ret.schema = this.schema;

  return ret;
};

/*!
 * Module exports.
 */

<<<<<<< HEAD
module.exports = DocumentArrayElement;
=======
module.exports = SchemaDocumentArrayElement;
>>>>>>> bd117058ee4d01e6fc9596bc87d402f7f452659e
